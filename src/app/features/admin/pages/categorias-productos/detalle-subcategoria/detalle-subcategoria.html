<!-- 
  Contenedor principal con el fondo oscuro
-->
<div class="w-full h-full flex flex-col bg-[#111317] text-white">
  <!-- 
    Barra de Título
    - Muestra "Bebidas > Bebidas Frias"
    - El link "Bebidas" te regresa al Paso 2
  -->
  <div class="flex items-center justify-between p-4 border-b border-gray-700 flex-none">
    <div class="flex items-center gap-2">
      <!-- Título de la Categoría Padre (Link a Paso 2) -->
      <!-- <a 
        [routerLink]="['/admin/listado-categorias-productos', 'categoria', categoriaId, categoriaNombre]"
        class="text-2xl font-bold font-montserrat text-gray-400 hover:text-[#3c82f5] transition-colors"
      >
        {{ categoriaNombre || '...' }}
      </a> -->

      <div class="flex items-center gap-4">
        <!-- Botón Volver -->
        <a
          [routerLink]="[
            '/admin/listado-categorias-productos/categoria',
            categoriaId,
            categoriaNombre
          ]"
          class="text-gray-400 hover:text-white transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
          </svg>
        </a>
        <!-- Título de la Categoría (dinámico) -->
        <span class="text-2xl font-bold font-montserrat">
          Categoría: <span class="">{{ categoriaNombre || 'Cargando...' }}</span>
        </span>
      </div>

      <!-- Separador -->
      <span class="text-2xl font-bold font-montserrat text-gray-500">/</span>

      <!-- Título de la Subcategoría (Actual) -->
      <span class="text-2xl font-bold font-montserrat text-[#3c82f5]">
        {{ subcategoriaNombre || 'Cargando...' }}
      </span>
    </div>
    <button
      (click)="showEditSubcategoryDialog()"
      class="flex-none px-4 py-2 text-[#3c82f5] text-sm font-medium rounded-lg transition-colors cursor-pointer hover:bg-[#1f242f] hover:text-white"
    >
      Editar Subcategoría
    </button>
  </div>

  <!-- 
    Área de Contenido
    - Solo la tabla de productos
  -->
  <div class="flex-1 p-4 overflow-y-auto flex flex-col gap-8">
    <!-- 
      SECCIÓN: Tabla de Productos
      - Esta es la tabla que pediste
    -->
    <div>
      <h2 class="text-xl font-bold mb-4 text-white">Productos en {{ subcategoriaNombre }}</h2>

      <!-- buscador buton para crear -->

      <div class="flex items-center justify-between gap-4 p-4 border-b border-gray-700 flex-none">
        <!-- Buscador -->
        <input
          type="text"
          placeholder="Buscar productos de la subcategoría..."
          class="w-full md:w-1/3 px-4 py-2 bg-[#1f242f] border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-[#3c82f5] transition-colors"
        />
        <!-- Botón Crear -->
        <button
          (click)="showCreateProductDialog()"
          class="flex-none px-4 py-2 bg-[#3c82f5] text-white text-sm font-medium rounded-lg hover:bg-[#5a9aff] transition-colors"
        >
          Crear Producto
        </button>
      </div>

      <!-- Contenedor de la Tabla -->
      <div class="bg-[#1f242f] rounded-lg shadow-md overflow-hidden">
        <table class="w-full">
          <thead class="bg-[#151a23]">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"
              >
                Producto
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"
              >
                Stock
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"
              >
                Precio
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"
              >
                Estado
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider"
              >
                Acciones
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-700">
            <!-- Fila de Producto -->
            <tr *ngFor="let prod of productos" class="hover:bg-[#252b38] transition-colors">
              <!-- Columna: Producto (Imagen y Nombre) -->
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">
                <div class="flex items-center gap-3">
                  <img
                    [src]="prod.product_urlimage || 'https://placehold.co/40x40/1f242f/FFF?text=P'"
                    alt="{{ prod.product_name }}"
                    class="w-10 h-10 rounded-md object-cover"
                  />
                  <span>{{ prod.product_name }}</span>
                </div>
              </td>

              <!-- Columna: Stock -->
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                Quedan {{ prod.product_stock }} und.
              </td>

              <!-- Columna: Precio -->
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                S/ {{ prod.product_price }}
              </td>

              <!-- Columna: Estado -->
              <td class="px-6 py-4 whitespace-nowrap text-sm">
                <span
                  class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full"
                  [ngClass]="
                    prod.product_state === '1'
                      ? 'bg-green-600 text-green-100'
                      : 'bg-red-600 text-red-100'
                  "
                >
                  {{ prod.product_state === '1' ? 'Activo' : 'Inactivo' }}
                </span>
              </td>

              <!-- Columna: Acciones -->
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                <button 
                  (click)="showEditProductDialog(prod)"
                class="text-[#3c82f5] hover:text-[#5a9aff] mr-3 transition-colors">
                  Editar
                </button>
                <button class="text-red-500 hover:text-red-400 transition-colors">Eliminar</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mensaje si no hay productos -->
      @if (productos.length === 0) {
      <div class="p-8 text-center bg-[#1f242f] rounded-lg mt-4 text-gray-500">
        No hay productos en esta subcategoría.
      </div>
      }
    </div>
  </div>
</div>


<app-category-modal
  [(visible)]="modalVisible"
  [mode]="modalMode"
  [itemType]="modalItemType"
  [initialData]="dataToEdit"
  (save)="onModalSave($event)"
></app-category-modal>

<!-- 
  ¡¡NUEVO!!
  MODAL REUTILIZABLE para PRODUCTO
-->
<app-product-modal
  [(visible)]="productModalVisible"
  [mode]="productModalMode"
  [initialData]="productDataToEdit"
  (save)="onProductModalSave($event)"
></app-product-modal>
